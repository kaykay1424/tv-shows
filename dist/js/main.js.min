$(document).ready(function(){let e=function(){let a,n=[],t=[],s=["id","name","genres","rating","image","network","schedule","language","country","status"],r="https://api.tvmaze.com/shows",l="https://api.tvmaze.com/search/shows?q=",o=0,i=null,c=null;function d(e,n=500){clearTimeout(a),a=setTimeout(function(){e()},n)}function u(e){let a=new Date,n=a.getFullYear()-e.getFullYear();return e.getMonth()>a.getMonth()?n-=1:e.getMonth()===a.getMonth()&&e.getDay()<a.getDay()&&(n-=1),n}function p(e,a){let r=!0;if("object"==typeof e)for(let a=0;a<s.length;a++)if(Object.keys(e).indexOf(s[a])<0){r=!1;break}r&&("filtered"===a?t.push(e):n.push(e))}function m(){$(".load-more.btn").length>0&&$(".load-more.btn").remove(),(i&&0===i.length||!i)&&$.ajax(`${r}?page=${o+1}`).then(()=>{$("#tv-shows").append('<button class="btn load-more">Load More Shows</button>')})}function g(){return c}function h(e,a){f(".tab-pane.active","before");let n,t=!1;$.ajax(`${r}/${e}/${a}`).then(function(e){let s="",r="",l="carousel-"+a;if(0===e.length&&(t=!0),e.forEach((e,n)=>{let t=0===n?"active":"";switch(s+=`<li data-target="${"#"+l}" data-slide-to="${n}" class="${t}">${n+1}</li>`,a){case"seasons":{let a=e.premiereDate===e.endDate?e.premiereDate:`${e.premiereDate.replace(/-/g,"/")} - ${e.endDate.replace(/-/g,"/")}`;r+=`\n                                <div class="carousel-item ${t}">\n                                    <div class="carousel-item-header">\n                                        <h5>Season ${e.number} (${a})</h5>\n                                        <p><b># of Episodes:</b> ${e.episodeOrder?e.episodeOrder:"N/A"}</p>                            \n                                    </div>\n                                    ${e.image?`<img src="${e.image.medium}" class="img-fluid ${e.summary?"float-left":"mx-auto"}" alt="image of season ${e.number}">`:""}                            \n                                    ${e.summary?e.summary:""}\n                                </div>\n                            `;break}case"episodes":r+=`\n                                <div class="carousel-item ${t}">\n                                    <div class="carousel-item-header">\n                                        <h5>${e.name} </h5>\n                                        <p><b>Episode #${e.number}</b> (Season ${e.season})</p>\n                                    </div>\n                                    ${e.image?`<img src="${e.image.medium}" class="img-fluid ${e.summary?"float-left":"mx-auto"}" alt="image of episode ${e.number}">`:""}                            \n                                    ${e.summary?e.summary:""}\n                                </div>\n                            `;break;case"cast":{let a=u(new Date(e.person.birthday)),n=e.person.deathday?`<p><b>Lived:</b>${new Date(e.person.birthday).getFullYear()}-${(new Date).getFullYear}`:`<p><b>Age:</b> ${a}`,s=e.person.country?`<p><b>Country:</b> ${e.person.country.name} </p>`:"";r+=`\n                                <div class="carousel-item ${t}">\n                                    <div class="carousel-item-header">\n                                        <h5 data-toggle="popover" data-content="${s+=n}">${e.person.name} (Actor) </h5>\n                                        <img src="${e.person.image.medium}" class="img-fluid mx-auto" alt="image of ${e.person.name}">\n                                    </div>\n                                    ${e.character.image?`\n                                        <div>\n                                            <h5>${e.character.name} (Character)</h5><img src=${e.character.image.medium} class='img-fluid mx-auto' alt='image of ${e.character.name}"'>\n                                        </div>`:""}\n                                </div>\n                            `;break}case"crew":{let a=u(new Date(e.person.birthday)),n=e.person.deathday?`<p><b>Lived:</b>${new Date(e.person.birthday).getFullYear()}-${(new Date).getFullYear}`:`<p><b>Age:</b> ${a}`,s=e.person.country?`<p><b>Country:</b> ${e.person.country.name} </p>`:"";r+=`\n                                    <div class="carousel-item ${t}">\n                                        <div class="carousel-item-header">\n                                            <h5 data-toggle="popover" data-content="${s+=n}">${e.person.name} (${e.type})</h5>                                            \n                                        </div>\n                                        ${e.person.image?`<img src="${e.person.image.medium}" class="img-fluid mx-auto" alt="image of${e.person.name}">`:""}\n                                    </div>\n                                `;break}}}),t)n="<p>No info found.</p>";else{n=`\n                        <div id="${l}" class="carousel slide" data-interval="false">                        \n                            <div class="carousel-inner">${r}</div>   \n                            <div class="carousel-controls">                     \n                                <a class="carousel-control-prev" href="${"#"+l}" role="button" data-slide="prev">\n                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>\n                                    <span class="sr-only">Previous</span>\n                                </a>\n                                <a class="carousel-control-next" href="${"#"+l}" role="button" data-slide="next">\n                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>\n                                    <span class="sr-only">Next</span>\n                                </a>\n                                <div class="carousel-indicators-container">\n                                    <ol class="carousel-indicators">${s}</ol>\n                                </div>                            \n                            </div>\n                        </div>\n                    `,$("body").popover({container:"body",html:!0,placement:"top",selector:'[data-toggle="popover"]',trigger:"click hover"})}v(),$("#"+a).append(n)}).catch(function(){v(),$("#"+a).append("<p>An error has occurred.</p>")})}function f(e,a){$(".loading-message-container").length>0&&$(".loading-message-container").remove();let n=$('\n                <div class="loading-message-container">\n                    <div class="spinner-border" role="status"></div> \n                    <span>Loading&#8230;</span>\n                </div>\n                ');"prepend"===a?$(e).prepend(n):$(e).append(n)}function v(){$(".loading-message-container").remove()}return{add:p,addListItem:function(e){let a=$('<li class="show list-group-item list-group-item-action"></li>');$(`<button class="btn btn-block text-left" data-target="#info-modal" data-toggle="modal">${e.name}</button>`).appendTo(a).on("click",()=>{!function({id:e,name:a,genres:n,rating:t,image:s,summary:r,language:l,country:o,premiered:i,schedule:c,network:u,status:p}){let m=g(),f=`                    \n                <p><span class="country ${"country"===m?"highlighted":""}">Country:</span> ${o||"N/A"} </p>    \n                <p><span class="language ${"language"===m?"highlighted":""}">Language:</span> ${l||"N/A"} </p> \n                <p><span class="premiered ${"premiered"===m?"highlighted":""}">Premiered:</span> ${i||"N/A"} </p> \n                <p><span class="status ${"status"===m?"highlighted":""}">Status:</span> ${p||"N/A"}</p>   \n                <p><span class="network ${"network"===m?"highlighted":""}">Network:</span> ${u||"N/A"} </p>     \n                <p><span class="schedule">Schedule:</span> ${c.time.length>0||c.days.length>0?`${c.days.join(", ")} ${c.time?`at ${c.time}`:""} `:"N/A"}      \n                <p><span class="rating ${"rating"===m?"highlighted":""}">Rating:</span> ${t||"N/A"}</p>\n                <p><span class="genres">Genres:</span>\n            `;if(0===n.length)f+="N/A</p>";else{let e=[];for(let a=0;a<n.length;a++)e.push(n[a]);f+=e.join(", "),f+="</p>"}s&&$(".modal-body .img-container").empty().append(`<img src="${s}" class="img-fluid mx-auto" alt="image of ${a}" />`),$(".modal-title").empty().append(a),$(".tab-pane").each(function(){$(this).empty(),"details"===$(this).prop("id")&&$(this).append(f),"summary"===$(this).prop("id")&&$(this).append(r)}),$(".nav-link, .tab-pane").removeClass("active show"),$("#summary-tab, #summary").addClass("active"),$("#summary").addClass("show"),$(".nav-link").click(function(){let a=$(this).attr("href"),n=a.replace("#","");"seasons"===n&&0===$(a).html().length&&d(()=>h(e,"seasons")),"episodes"===n&&0===$(a).html().length&&d(()=>h(e,"episodes")),"cast"===n&&0===$(a).html().length&&d(()=>h(e,"cast")),"crew"===n&&0===$(a).html().length&&d(()=>h(e,"crew"))})}(e)}),$("#tv-shows-list").append(a)},addLoadMoreButton:m,debounce:d,displayShows:function(a){if($("#tv-shows-list").empty(),$(".load-more,.no-results-message").remove(),a.length>0){let n=e.getSortFactor();n&&(a=e.sortShows(n)),a.forEach(a=>e.addListItem(a)),m()}else $("#tv-shows").prepend('<div class="alert alert-warning no-results-message">No shows found.</div>')},loadList:function(){let e=i&&""!==i?l+i:`${r}?page=${o}`;return f("#tv-shows",0===o&&!i||i?"before":"after"),$.ajax(e).then(function(e){t=[],e.forEach(e=>{e.name||(e=e.show);let a={id:e.id,name:e.name,country:e.network?e.network.country.name:null,genres:e.genres?e.genres:null,language:e.language?e.language:null,rating:e.rating.average?e.rating.average:null,premiered:new Date(e.premiered).getFullYear(),schedule:e.schedule?e.schedule:null,network:e.network?e.network.name:null,summary:e.summary?e.summary:null,status:e.status?e.status:null,image:e.image?e.image.medium:null};p(a,i?"filtered":"all")}),v()}).catch(function(){v()})},getAll:function(e){return"filtered"===e?t:n},getPage:function(){return o},getSortFactor:g,setPage:function(e){o=e},setSearch:function(e){i=e},setSortFactor:function(e){c=e},sortShows:function(e){let a=i?t:n;return(a=JSON.parse(JSON.stringify(a))).sort((a,n)=>{if("country"===e||"language"===e){if(!a[e]||!n[e])return a[e]||n[e]?!a[e]&&n[e]?-1:1:0;{let t=a[e].toLowerCase(),s=n[e].toLowerCase();if(t>s)return 1;if(t===s)return 0;if(t<s)return-1}}return a[e]-n[e]}),a}}}();e.loadList().then(function(){e.displayShows(e.getAll("all"))}),$("#search").keyup(()=>{let a=$("#search").val();e.setSearch(a.length>0?a:null),e.debounce(()=>{0!==a.length?e.loadList().then(function(){e.displayShows(e.getAll("filtered"))}):e.displayShows(e.getAll("all"))},500)}),$("#sort-search").change(function(){let a=""===$(this).val()?null:$(this).val();e.setSortFactor(a);let n=e.getAll("filtered");n.length>0?e.displayShows(n):e.displayShows(e.getAll("all"))}),$(document).on("click",".load-more.btn",function(){$(this).remove(),e.setPage(e.getPage()+1),e.loadList().then(function(){e.displayShows(e.getAll("all"))})})});