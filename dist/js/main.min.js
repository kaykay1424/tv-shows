$(document).ready(function(){let e=function(){const n=[],a=[],t=["id","name","genres","rating","image","network","schedule","language","country","status"],s="https://api.tvmaze.com/shows",o="https://api.tvmaze.com/search/shows?q=";let l,r=0,i=null,c=null;function d(e,n=500){clearTimeout(l),l=setTimeout(function(){e()},n)}function u(e){const n=new Date,a=n.getMonth(),t=n.getFullYear(),s=e.getMonth(),o=e.getFullYear();return s>a||s===a&&e.getDay()<n.getDay()?t-o-1:t-o}function p(e,s){let o=!0;if("object"==typeof e)for(let n=0;n<t.length;n++)if(Object.keys(e).indexOf(t[n])<0){o=!1;break}o&&("filtered"===s?a.push(e):n.push(e))}function g(){const e=$(".load-more");e.length>0&&e.remove(),(i&&0===i.length||!i)&&$.ajax(`${s}?page=${r+1}`).then(()=>{$("#tv-shows").append('<button class="btn load-more">Load More Shows</button>')})}function m(){return c}function h(e,n){f(".tab-pane.active","before");let a,t=!1;$.ajax(`${s}/${e}/${n}`).then(function(e){let s="",o="",l="carousel-"+n;if(0===e.length&&(t=!0),e.forEach((e,a)=>{const t=0===a?"active":"";s+=`<li data-target="${"#"+l}" data-slide-to="${a}" class="${t}">${a+1}</li>`,o+=function(e,n,a){let t;const s=n.image?n.image.medium:null,o=n.person&&n.person.image?n.person.image.medium:null,l=n.summary;switch(e){case"seasons":{const e=n.endDate,o=n.premiereDate,r=o===e?o:`${o.replace(/-/g,"/")} - ${e.replace(/-/g,"/")}`,i=n.number;t=`\n                        <div class="carousel-item ${a}">\n                            <div class="carousel-item-header">\n                                <h5>Season ${i} (${r})</h5>\n                                <p><b># of Episodes:</b> ${n.episodeOrder?n.episodeOrder:"N/A"}</p>                            \n                            </div>\n                            ${s?`<img src="${s}" class="img-fluid ${l?"float-left":"mx-auto"}" alt="image of season ${i}">`:""}                            \n                            ${l||""}\n                        </div>\n                    `;break}case"episodes":{const e=n.number;t=`\n                        <div class="carousel-item ${a}">\n                            <div class="carousel-item-header">\n                                <h5>${n.name} </h5>\n                                <p><b>Episode #${e}</b> (Season ${n.season})</p>\n                            </div>\n                            ${s?`<img src="${s}" class="img-fluid ${l?"float-left":"mx-auto"}" alt="image of episode ${e}">`:""}                            \n                            ${l||""}\n                        </div>\n                    `;break}case"cast":{const e=new Date(n.person.birthday),s=n.person.name,l=u(e),r=n.person.deathday?`<p><b>Lived:</b>${e.getFullYear()}-${(new Date).getFullYear}`:`<p><b>Age:</b> ${l}`,i=n.character.image?n.character.image.medium:"",c=n.character.name;let d=n.person.country?`<p><b>Country:</b> ${n.person.country.name} </p>`:"";t=`\n                        <div class="carousel-item ${a}">\n                            <div class="carousel-item-header">\n                                <h5 data-toggle="popover" data-content="${d+=r}">${s} (Actor) </h5>\n                                ${o?`<img src="${o}" class="img-fluid mx-auto" alt="image of ${s}">`:""}\n                            </div>\n                            ${i?`\n                                <div>\n                                    <h5>${c} (Character)</h5><img src=${i} class='img-fluid mx-auto' alt='image of ${c}"'>\n                                </div>`:""}\n                        </div>\n                    `;break}case"crew":{const e=new Date(n.person.birthday),s=u(e),l=n.person.deathday?`<p><b>Lived:</b>${e.getFullYear()}-${(new Date).getFullYear}`:`<p><b>Age:</b> ${s}`,r=n.person.name;let i=n.person.country?`<p><b>Country:</b> ${n.person.country.name} </p>`:"";t=`\n                            <div class="carousel-item ${a}">\n                                <div class="carousel-item-header">\n                                    <h5 data-toggle="popover" data-content="${i+=l}">${r} (${n.type})</h5>                                            \n                                </div>\n                                ${o?`<img src="${o}" class="img-fluid mx-auto" alt="image of${r}">`:""}\n                            </div>\n                        `;break}}return t}(n,e,t)}),t)a="<p>No info found.</p>";else{a=`\n                        <div id="${l}" class="carousel slide" data-interval="false">                        \n                            <div class="carousel-inner">${o}</div>   \n                            <div class="carousel-controls">                     \n                                <a class="carousel-control-prev" href="${"#"+l}" role="button" data-slide="prev">\n                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>\n                                    <span class="sr-only">Previous</span>\n                                </a>\n                                <a class="carousel-control-next" href="${"#"+l}" role="button" data-slide="next">\n                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>\n                                    <span class="sr-only">Next</span>\n                                </a>\n                                <div class="carousel-indicators-container">\n                                    <ol class="carousel-indicators">${s}</ol>\n                                </div>                            \n                            </div>\n                        </div>\n                    `,$("body").popover({container:"body",html:!0,placement:"top",selector:'[data-toggle="popover"]',trigger:"click hover"})}v(),$("#"+n).append(a)}).catch(function(){v(),$("#"+n).append("<p>An error has occurred.</p>")})}function f(e,n){$(".loading-message-container").length>0&&$(".loading-message-container").remove();const a=$('\n                <div class="loading-message-container">\n                    <div class="spinner-border" role="status"></div> \n                    <span>Loading&#8230;</span>\n                </div>\n                ');"prepend"===n?$(e).prepend(a):$(e).append(a)}function v(){$(".loading-message-container").remove()}return{add:p,addListItem:function(e){const n=$('<li class="show list-group-item list-group-item-action"></li>');$(`<button class="btn btn-block text-left" data-target="#info-modal" data-toggle="modal">${e.name}</button>`).appendTo(n).on("click",()=>{!function({id:e,name:n,genres:a,rating:t,image:s,summary:o,language:l,country:r,premiered:i,schedule:c,network:u,status:p}){const g=m();let f=`                    \n                <p><span class="country ${"country"===g?"highlighted":""}">Country:</span> ${r||"N/A"} </p>    \n                <p><span class="language ${"language"===g?"highlighted":""}">Language:</span> ${l||"N/A"} </p> \n                <p><span class="premiered ${"premiered"===g?"highlighted":""}">Premiered:</span> ${i||"N/A"} </p> \n                <p><span class="status ${"status"===g?"highlighted":""}">Status:</span> ${p||"N/A"}</p>   \n                <p><span class="network ${"network"===g?"highlighted":""}">Network:</span> ${u||"N/A"} </p>     \n                <p><span class="schedule">Schedule:</span> ${c.time.length>0||c.days.length>0?`${c.days.join(", ")} ${c.time?`at ${c.time}`:""} `:"N/A"}      \n                <p><span class="rating ${"rating"===g?"highlighted":""}">Rating:</span> ${t||"N/A"}</p>\n                <p><span class="genres">Genres:</span>\n            `;if(0===a.length)f+="N/A</p>";else{const e=[];for(let n=0;n<a.length;n++)e.push(a[n]);f+=e.join(", "),f+="</p>"}s&&$(".modal-body .img-container").empty().append(`<img src="${s}" class="img-fluid mx-auto" alt="image of ${n}" />`),$(".modal-title").empty().append(n),$(".tab-pane").each(function(){$(this).empty(),"details"===$(this).prop("id")&&$(this).append(f),"summary"===$(this).prop("id")&&$(this).append(o)}),$(".nav-link, .tab-pane").removeClass("active show"),$("#summary-tab, #summary").addClass("active"),$("#summary").addClass("show"),$(".nav-link").click(function(){const n=$(this).attr("href"),a=n.replace("#","");"seasons"===a&&0===$(n).html().length&&d(()=>h(e,"seasons")),"episodes"===a&&0===$(n).html().length&&d(()=>h(e,"episodes")),"cast"===a&&0===$(n).html().length&&d(()=>h(e,"cast")),"crew"===a&&0===$(n).html().length&&d(()=>h(e,"crew"))})}(e)}),$("#tv-shows-list").append(n)},addLoadMoreButton:g,debounce:d,displayShows:function(n){if($("#tv-shows-list").empty(),$(".load-more,.no-results-message").remove(),n.length>0){const a=e.getSortFactor();a&&(n=e.sortShows(a)),n.forEach(n=>e.addListItem(n)),g()}else $("#tv-shows").prepend('<div class="alert alert-warning no-results-message">No shows found.</div>')},loadList:function(){const e=i?o+i:`${s}?page=${r}`;return f("#tv-shows",0===r&&!i||i?"before":"after"),$.ajax(e).then(function(e){i&&(a.length=0),e.forEach(e=>{e.name||(e=e.show);const n={id:e.id,name:e.name,country:e.network?e.network.country.name:null,genres:e.genres?e.genres:null,language:e.language?e.language:null,rating:e.rating.average?e.rating.average:null,premiered:new Date(e.premiered).getFullYear(),schedule:e.schedule?e.schedule:null,network:e.network?e.network.name:null,summary:e.summary?e.summary:null,status:e.status?e.status:null,image:e.image?e.image.medium:null};p(n,i?"filtered":"all")}),v()}).catch(function(){v()})},getAll:function(e){return"filtered"===e?a:n},getPage:function(){return r},getSortFactor:m,setPage:function(e){r=e},setSearch:function(e){i=e},setSortFactor:function(e){c=e},sortShows:function(e){return[...i?a:n].sort((n,a)=>{if("country"===e||"language"===e||"network"===e||"status"===e){const t=n[e]?n[e].toLowerCase().replace(/\s/g,""):null,s=a[e]?a[e].toLowerCase().replace(/\s/g,""):null;if(t&&s&&t>s||t&&!s)return 1;if(t&&s&&t===s||!t&&!s)return 0;if(t&&s&&t<s||!t&&s)return-1}return n[e]-a[e]})}}}();e.loadList().then(function(){e.displayShows(e.getAll("all"))}),$("#search").keyup(()=>{const n=$("#search").val();e.setSearch(n.length>0?n:null),e.debounce(()=>{0!==n.length?e.loadList().then(function(){e.displayShows(e.getAll("filtered"))}):e.displayShows(e.getAll("all"))},500)}),$("#sort-search").change(function(){e.setSortFactor(""===$(this).val()?null:$(this).val());const n=e.getAll("filtered");n.length>0?e.displayShows(n):e.displayShows(e.getAll("all"))}),$(document).on("click",".load-more",function(){$(this).remove(),e.setPage(e.getPage()+1),e.loadList().then(function(){e.displayShows(e.getAll("all"))})})});